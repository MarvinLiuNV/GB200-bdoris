SETTINGS:
  name: nccl_health_check

VARS:
  CLUSTER_NAME: ""
  CONFIGURATION: ""
  TAGS: ""
  BENCHMARK: ""

  CUDA_VISIBLE_DEVICES: ""
  NCCL_IB_HCA: ""
  INTERFACE: ""
  NCCL_EXP_BW: 10

  NUM_GPUS: 4
  NTASKS_PER_NODE: 4
  CONTAINER: ""
  SLURM_PARTITION: ""
  NCCL_SOCKET: ""
  MELLANOX_VISIBLE_DEVICES: ""
  RACK_A: ""
  RACK_B: ""

  NCCL_MNNVL_ENABLE: 0

JOBS:
 - monitor.yaml --INTERFACE={INTERFACE} &
  rack_nccl_all_reduce.yaml
  --NCCL_MNNVL_ENABLE={NCCL_MNNVL_ENABLE}
  --CONTAINER={CONTAINER} --SLURM_PARTITION={SLURM_PARTITION} --NCCL_EXP_BW={NCCL_EXP_BW}
  --CONFIGURATION={CONFIGURATION} --CLUSTER_NAME={CLUSTER_NAME} --TAGS={TAGS} --BENCHMARK={BENCHMARK}
  --NCCL_SOCKET={NCCL_SOCKET} --MELLANOX_VISIBLE_DEVICES={MELLANOX_VISIBLE_DEVICES}
  --CUDA_VISIBLE_DEVICES={CUDA_VISIBLE_DEVICES} --NCCL_IB_HCA={NCCL_IB_HCA} --NTASKS_PER_NODE={NTASKS_PER_NODE} --NUM_GPUS={NUM_GPUS}
  --HOSTS={RACK_A} --JOB_ID=1 &
  rack_nccl_all_reduce.yaml
  --NCCL_MNNVL_ENABLE={NCCL_MNNVL_ENABLE}
  --CONTAINER={CONTAINER} --SLURM_PARTITION={SLURM_PARTITION} --NCCL_EXP_BW={NCCL_EXP_BW}
  --CONFIGURATION={CONFIGURATION} --CLUSTER_NAME={CLUSTER_NAME} --TAGS={TAGS} --BENCHMARK={BENCHMARK}
  --NCCL_SOCKET={NCCL_SOCKET} --MELLANOX_VISIBLE_DEVICES={MELLANOX_VISIBLE_DEVICES}
  --CUDA_VISIBLE_DEVICES={CUDA_VISIBLE_DEVICES} --NCCL_IB_HCA={NCCL_IB_HCA} --NTASKS_PER_NODE={NTASKS_PER_NODE} --NUM_GPUS={NUM_GPUS}
  --HOSTS={RACK_B} --JOB_ID=2
